const fs = require("fs");
const path = require("path");

const iconsDir = path.resolve(__dirname, "../icons");
const outputFile = path.resolve(__dirname, "../src/mapping/iconMap.tsx");

if (!fs.existsSync(iconsDir)) {
  console.error("Icons directory not found:", iconsDir);
  process.exit(1);
}

const files = fs.readdirSync(iconsDir).filter(file => file.endsWith(".svg"));

if (files.length === 0) {
  console.error("❌ No .svg files found in icons directory");
  process.exit(1);
}

const lines = [
  `// This file is auto-generated by scripts/generate-icon-map.js`,
  `// Do not edit manually.`,
  ``,
  `import React from "react";`,
  ...files.map(
    file => `import ${sanitizeName(file)} from "../../icons/${file}";`
  ),
  ``,
  `export const iconMap: Record<string, React.FC<React.SVGProps<SVGSVGElement>>> = {`,
  ...files.map(
    file =>
      `  "${path.basename(file, ".svg")}": ${sanitizeName(file)},`
  ),
  `};`,
  ``,
];

fs.writeFileSync(outputFile, lines.join("\n"), "utf8");

console.log(`iconMap.ts generated with ${files.length} icons.`);

function sanitizeName(fileName) {
  const base = path.basename(fileName, ".svg");
  return base
    .replace(/[-\s]/g, "_")
    .replace(/[^\w]/g, "")
    .replace(/^(\d)/, "_$1");
}